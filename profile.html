<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>#HUMANITY Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      background: #000;
      color: #e0e0e0;
      font-family: 'Courier New', monospace;
      padding: 40px 20px;
      max-width: 600px;
      margin: 0 auto;
      text-align: center;
    }
    h1 { color: #0ff; margin-bottom: 20px; }
    input, textarea, button {
      display: block;
      width: 100%;
      max-width: 400px;
      margin: 10px auto;
      padding: 10px;
      background: #111;
      color: #fff;
      border: 1px solid #0ff;
      border-radius: 4px;
      box-sizing: border-box;
    }
    textarea { height: 100px; resize: vertical; }
    button {
      background: #0ff;
      color: #000;
      border: none;
      cursor: pointer;
    }
    button:hover { background: #0cc; }
    img.avatar {
      display: block;
      margin: 20px auto;
      width: 100px;
      height:100px;
      border-radius:50%;
      object-fit:cover;
      border:2px solid #0ff;
    }
    a.back-link {
      color: #0ff;
      display: block;
      margin-top: 30px;
      text-decoration: none;
    }
    #viewProfile { display: none; }
  </style>
</head>
<body>
  <h1 id="pageTitle">My Profile</h1>
  <!-- AUTH CONTROLS -->
  <button id="showRegisterBtn">Register</button>
  <button id="showLoginBtn">Login</button>

  <!-- REGISTER Modal -->
  <div id="registerModal" class="hidden">
    <input id="regEmail"    type="email"    placeholder="Email">
    <input id="regPassword" type="password" placeholder="Password">
    <input id="regUsername" type="text"     placeholder="Display Name">
    <button id="doRegister">Create Account</button>
    <button onclick="closeModal('registerModal')">Cancel</button>
  </div>

  <!-- LOGIN Modal -->
  <div id="loginModal" class="hidden">
    <input id="loginEmail"    type="email"    placeholder="Email">
    <input id="loginPassword" type="password" placeholder="Password">
    <button id="doLogin">Login</button>
    <button onclick="closeModal('loginModal')">Cancel</button>
  </div>

  <!-- EDIT MODE -->
  <div id="editProfile">
    <label>Username</label>
    <input id="usernameInput" placeholder="e.g. NeoCoder" />

    <label>Avatar URL</label>
    <input id="avatarURLInput" placeholder="https://..." />

    <label>Bio</label>
    <textarea id="bioInput" placeholder="Tell us about yourself…"></textarea>

    <button id="saveProfileBtn">Save Profile</button>
  </div>

  <!-- VIEW MODE -->
  <div id="viewProfile">
    <h1 id="viewHandle"></h1>
    <img id="viewAvatar" class="avatar" src="" alt="Avatar" />
    <p id="viewBio"></p>
  </div>

  <a href="social.html" class="back-link">← Back to Feed</a>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <!-- >>> ADD THIS: Auth SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

  <script>
    // Initialize Firebase
    const cfg = {
      apiKey: "AIzaSyBT7P7DAV-I9ESe6r9JdpS1oCyGIKb09J4",
      authDomain: "hashhumanity-58b9a.firebaseapp.com",
      projectId: "hashhumanity-58b9a",
      storageBucket: "hashhumanity-58b9a.appspot.com",
      messagingSenderId: "886745899016",
      appId: "1:886745899016:web:2b07e043c2434379d71bd"
    };
    firebase.initializeApp(cfg);
    const db = firebase.firestore();

    // Helpers to show/hide sections
    const editEl = document.getElementById('editProfile');
    const viewEl = document.getElementById('viewProfile');
    const title  = document.getElementById('pageTitle');
    const params = new URLSearchParams(location.search);
    const viewed = params.get('user');               // handle from URL
    const me     = localStorage.getItem('h_username');

    // VIEW-ONLY mode if ?user=someone and not your own handle
    if (viewed && viewed !== me) {
      editEl.style.display = 'none';
      viewEl.style.display = 'block';
      title.textContent   = viewed + "'s Profile";

      // Fetch that user’s profile from Firestore
      db.collection('users').doc(viewed).get()
        .then(doc => {
          const data = doc.data() || {};
          document.getElementById('viewHandle').textContent = viewed;
          document.getElementById('viewAvatar').src =
            data.avatar || 'https://via.placeholder.com/100';
          document.getElementById('viewBio').textContent =
            data.bio || 'No bio set.';
        });
    }
    else {
      // EDIT mode
      viewEl.style.display = 'none';
      title.textContent    = 'Set Up Your Profile';

      // Prefill from localStorage
      document.getElementById('usernameInput').value = me || '';
      document.getElementById('avatarURLInput').value = localStorage.getItem('h_avatar') || '';
      document.getElementById('bioInput').value       = localStorage.getItem('h_bio')    || '';

      // Save handler
      document.getElementById('saveProfileBtn')
        .addEventListener('click', async () => {

          const user   = document.getElementById('usernameInput').value.trim();
          const avatar = document.getElementById('avatarURLInput').value.trim();
          const bio    = document.getElementById('bioInput').value.trim();

          if (!user) {
            alert('Username is required.');
            return;
          }

          // 1) Store locally
          localStorage.setItem('h_username', user);
          localStorage.setItem('h_avatar',   avatar);
          localStorage.setItem('h_bio',      bio);

          // 2) Persist to Firestore
          await db.collection('users').doc(user).set({ avatar, bio });

          alert('Profile saved!');
          // After first save, you can redirect back:
          // location.href = 'social.html';
        });
    }
  </script>
</body>
</html>

   >

