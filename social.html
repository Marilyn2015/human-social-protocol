<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>#HUMANITY Social</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.0/dist/purify.min.js"></script>
  <style>
    body { background: #000; color: #e0e0e0; font-family: 'Courier New', monospace; padding: 40px 20px; max-width: 800px; margin: 0 auto; }
    h1 { text-align: center; color: #fff; font-size: 2.5rem; margin-bottom: 20px; text-shadow: 0 0 8px #0ff; }
    .button-group { text-align: center; margin-bottom: 20px; }
    button { background: #000; color: #fff; border: 1px solid #0ff; border-radius: 4px; padding: 8px 16px; cursor: pointer; margin: 0 5px; box-shadow: 0 0 5px #0ff, inset 0 0 3px #0ff; transition: .2s; }
    button:hover { background: #0ff; color: #000; }
    textarea, input[type="file"], input[type="text"] { width: 100%; background: #0a0a0a; color: #fff; border: 1px solid #444; padding: 12px; margin: 12px 0; border-radius: 4px; box-sizing: border-box; }
    #postBox { height: 150px; resize: vertical; }
    #msgBox { height: 60px; resize: none; }
    .post, .message-item { background: #111; border: 1px solid #333; padding: 12px; margin-bottom: 16px; border-radius: 6px; }
    .meta { font-size: .75rem; color: #888; margin-bottom: 8px; display: flex; align-items: center; }
    .meta img { width: 24px; height: 24px; border-radius: 50%; margin-right: 8px; border: 1px solid #0ff; }
    .post-content { line-height: 1.4; }
    #userInfo { display: none; flex-direction: column; align-items: center; margin-bottom: 20px; }
    #profileAvatar, #viewAvatar, #avatarPreview { width: 64px; height: 64px; border-radius: 50%; border: 2px solid #0ff; object-fit: cover; margin-bottom: 8px; }
    #profileName, #viewUsername { font-size: 1.2rem; color: #0ff; }
    #profileBio, #viewBio { font-size: .9rem; color: #ccc; text-align: center; margin-bottom: 12px; }
    #profilePage { display: none; }
  </style>
</head>
<body>
  <h1>#HUMANITY</h1>

  <!-- Profile Header -->
  <div id="userInfo">
    <img id="profileAvatar" src="https://via.placeholder.com/64" alt="Avatar">
    <span id="profileName"></span>
    <p id="profileBio"></p>
  </div>

  <div class="button-group">
    <button id="btn-profile-page">üë§ My Profile</button>
    <button id="btn-back-feed" style="display:none;">üè† Back to Feed</button>
  </div>

  <!-- Feed Section: Share + Past Posts -->
  <div id="feedSection">
    <textarea id="postBox" placeholder="What‚Äôs on your fucking mind?"></textarea>
    <div class="button-group"><button id="btn-share">Share</button></div>
    <h2 style="color:#0ff; margin-top:0;">Previous Posts</h2>
    <div id="feed"></div>
  </div>

  <!-- Profile Page -->
  <div id="profilePage">
    <h2>Your Profile</h2>
    <img id="viewAvatar" src="https://via.placeholder.com/64" alt="Avatar">
    <span id="viewUsername"></span>
    <p id="viewBio"></p>
    <div class="button-group">
      <button id="btn-edit-profile">‚úèÔ∏è Edit Profile</button>
    </div>
    <div id="editSection" style="display:none; text-align:left;">
      <h3>Edit Profile</h3>
      <label>Avatar:</label>
      <input type="file" id="inputAvatarFile" accept="image/*">
      <img id="avatarPreview" src="" alt="Preview">
      <label>Username:</label>
      <input type="text" id="inputUsername" placeholder="Username">
      <label>Bio:</label>
      <textarea id="inputBio" placeholder="Tell us about yourself..."></textarea>
      <div class="button-group">
        <button id="btn-save-profile">Save</button>
        <button id="btn-cancel-edit">Cancel</button>
      </div>
    </div>

    <h3>Messages</h3>
    <!-- Recipient field -->
    <input type="text" id="msgTo" placeholder="Send to...">
    <div id="messageList"></div>
    <textarea id="msgBox" placeholder="Type your message..."></textarea>
    <div class="button-group"><button id="btn-send-msg">Send</button></div>
  </div>

  <script>
    // Utilities
    function getCurrentUser() {
      let u = localStorage.getItem('h_username');
      if (!u) {
        u = 'anon_' + Math.random().toString(36).substr(2,5);
        localStorage.setItem('h_username', u);
      }
      return u;
    }
    function getAvatar() { return localStorage.getItem('h_avatar') || 'https://via.placeholder.com/64'; }
    function getBio()    { return localStorage.getItem('h_bio')    || ''; }

    // Elements
    const userInfo      = document.getElementById('userInfo');
    const profileAvatar = document.getElementById('profileAvatar');
    const profileName   = document.getElementById('profileName');
    const profileBio    = document.getElementById('profileBio');
    const feedSection   = document.getElementById('feedSection');
    const feed          = document.getElementById('feed');
    const postBox       = document.getElementById('postBox');
    const btnShare      = document.getElementById('btn-share');
    const profilePage   = document.getElementById('profilePage');
    const btnProfile    = document.getElementById('btn-profile-page');
    const btnBackFeed   = document.getElementById('btn-back-feed');

    const viewAvatar    = document.getElementById('viewAvatar');
    const viewUsername  = document.getElementById('viewUsername');
    const viewBio       = document.getElementById('viewBio');
    const btnEdit       = document.getElementById('btn-edit-profile');
    const editSection   = document.getElementById('editSection');
    const inputAvatar   = document.getElementById('inputAvatarFile');
    const avatarPreview = document.getElementById('avatarPreview');
    const inputUsername = document.getElementById('inputUsername');
    const inputBio      = document.getElementById('inputBio');
    const btnSave       = document.getElementById('btn-save-profile');
    const btnCancel     = document.getElementById('btn-cancel-edit');

    const msgTo         = document.getElementById('msgTo');
    const messageList   = document.getElementById('messageList');
    const msgBox        = document.getElementById('msgBox');
    const btnSendMsg    = document.getElementById('btn-send-msg');

    // Load feed posts
    function loadFeed() {
      feed.innerHTML = '';
      const posts = JSON.parse(localStorage.getItem('posts') || '[]');
      if (posts.length === 0) {
        feed.innerHTML = '<p style="color:#888;">No posts yet.</p>';
        return;
      }
      posts.forEach(p => {
        const d = document.createElement('div');
        d.className = 'post';
        d.innerHTML = `<div class="meta"><img src="${DOMPurify.sanitize(p.avatar)}"><strong>${DOMPurify.sanitize(p.user)}</strong></div><div class="post-content">${DOMPurify.sanitize(p.text)}</div>`;
        feed.appendChild(d);
      });
    }
    function sharePost() {
      const text = postBox.value.trim(); if (!text) return;
      const posts = JSON.parse(localStorage.getItem('posts') || '[]');
      posts.unshift({ user: getCurrentUser(), avatar: getAvatar(), text, timestamp: Date.now() });
      localStorage.setItem('posts', JSON.stringify(posts));
      postBox.value = '';
      loadFeed();
    }

    // Profile functions
    function updateHeader() {
      profileAvatar.src = getAvatar();
      profileName.textContent = getCurrentUser();
      profileBio.textContent  = getBio();
    }
    function showProfile() {
      updateHeader();
      viewAvatar.src        = getAvatar();
      viewUsername.textContent = getCurrentUser();
      viewBio.textContent      = getBio();
      userInfo.style.display    = 'flex';
      feedSection.style.display = 'none';
      profilePage.style.display = 'block';
      btnBackFeed.style.display = 'inline-block';
      loadMessages();
    }
    function showFeed() {
      userInfo.style.display    = 'none';
      profilePage.style.display  = 'none';
      feedSection.style.display  = 'block';
      btnBackFeed.style.display  = 'none';
    }

    // Edit profile
    inputAvatar.addEventListener('change', () => {
      const f = inputAvatar.files[0]; if (!f) return;
      avatarPreview.src = URL.createObjectURL(f);
    });
    btnEdit.addEventListener('click', () => { editSection.style.display = 'block'; });
    btnSave.addEventListener('click', () => {
      const name = inputUsername.value.trim() || getCurrentUser();
      localStorage.setItem('h_username', name);
      if (avatarPreview.src) localStorage.setItem('h_avatar', avatarPreview.src);
      const b = inputBio.value.trim();
      if (b) localStorage.setItem('h_bio', b); else localStorage.removeItem('h_bio');
      editSection.style.display = 'none';
      showProfile();
    });
    btnCancel.addEventListener('click', () => { editSection.style.display = 'none'; });

    // Messages
    function loadMessages() {
      messageList.innerHTML = '';
      const msgs = JSON.parse(localStorage.getItem('messages') || '[]');
      msgs.forEach(m => {
        const d = document.createElement('div'); d.className = 'message-item';
        d.textContent = `[${new Date(m.timestamp).toLocaleTimeString()}] ${m.user} ‚Üí ${m.recipient}: ${m.text}`;
        messageList.appendChild(d);
      });
    }
    btnSendMsg.addEventListener('click', () => {
      const t = msgBox.value.trim(); if (!t) return;
      const r = msgTo.value.trim(); if (!r) { alert('Specify a recipient.'); return; }
      const msgs = JSON.parse(localStorage.getItem('messages') || '[]');
      msgs.push({ user: getCurrentUser(), recipient: r, text: t, timestamp: Date.now() });
      localStorage.setItem('messages', JSON.stringify(msgs));
      msgBox.value = '';
      loadMessages();
    });

    // Event listeners
    btnShare.addEventListener('click', sharePost);
    btnProfile.addEventListener('click', showProfile);
    btnBackFeed.addEventListener('click', showFeed);

    document.addEventListener('DOMContentLoaded', () => {
      updateHeader();
      loadFeed();
      showFeed();
    });
  </script>
</body>
</html>
